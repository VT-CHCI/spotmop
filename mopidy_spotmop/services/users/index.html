<!DOCTYPE html>
<html>
<head>
  <title>WebSockets Client</title>  
  <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
</head>
<body>
Enter text to send to the websocket server:
<div id="send">
	<strong id="status">loading</strong>
    <input type="text" id="name" value="" />
    <input type="button" id="notify" value="notify"/>
</div>
<div id="output"></div>
</body>
</html>
<script>

jQuery(function($){

	if (!("WebSocket" in window)) {
		alert("Your browser does not support web sockets");
	}else{
		setup();
	}

	function setup(){
	   
		// Note: You have to change the host var 
		// if your client runs on a different machine than the websocket server
		
		var host = "ws://music.james:6681/pusher";
		var socket = new WebSocket(host);
		var status = $('#status');
		var btnNotify = $("#notify");
		var name = $("#name");

		// event handlers for UI
		btnNotify.on('click',function(){
			var object = {
					user: name.val(),
					count: 13,
					message: 'Tracks added'
				};
			console.log('sending message');
			console.log( object );
			socket.send( JSON.stringify(object) );
		});

		// event handlers for websocket
		if(socket){
			
			console.log(' socket valid ');

			socket.onopen = function(){
				console.info("connection opened....");
				status.html( 'connected' );
			}

			socket.onmessage = function( response ){
				console.info("Incoming...");
				console.log(response);
				showServerResponse( response.data );
			}

			socket.onclose = function(){
				console.info("connection closed....");
				status.html( 'disconnected' );
			}

		}else{
			console.log("invalid socket");
		}

		function showServerResponse( response ){
			response = JSON.parse( response );
			var p = document.createElement('p');
			p.innerHTML = response.message + ' from '+ response.user;
			document.getElementById('output').appendChild(p); 
		}

	}

});

</script>